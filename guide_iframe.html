<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Prévention PACA – Vue intégrée</title>

<style>
  html,body {
    margin:0; padding:0;
    height:100%;
    background:#020617;
  }

  #wrapper {
    position:fixed;
    inset:0;
    overflow:hidden;
    background:#020617;
  }

  iframe {
    width:100%;
    height:100%;
    border:0;
    position:absolute;
    top:0; left:0;
  }
</style>
</head>
<body>

<div id="wrapper">
  <iframe id="gristFrame" src="" allowfullscreen></iframe>
</div>

<script>
//
//  VERSION QUI MASQUE TOUT À 100%
//  — pas de titre
//  — pas de menus
//  — pas de header
//  — pas de filtre
//  — pas d’iframe imbriquée
//  — ultrarapide
//

function cleanUrl(u) {
  if (!u) return "";
  u = decodeURIComponent(u);

  // On vire les paramètres Grist qui foutent la pagaille
  u = u.replace(/[\?&]themeMode\=[^&]+/, "");
  u = u.replace(/[\?&]tour\=[^&]+/, "");
  u = u.replace(/[\?&]layout\=[^&]+/, "");
  u = u.replace(/[\?&]view\=[^&]+/, "");

  // On force l'affichage plein écran
  if (!u.includes("?")) u += "?";
  if (!u.includes("embed=true")) u += "&embed=true";
  if (!u.includes("style=singlePage")) u += "&style=singlePage";
  if (!u.includes("exclude-headers=true")) u += "&exclude-headers=true";

  return u;
}

// Récupère l’URL après #
const raw = window.location.hash.substring(1);
document.getElementById("gristFrame").src = cleanUrl(raw);
</script>

</body>
</html>
