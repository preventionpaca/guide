<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prévention PACA – Vue intégrée</title>
  <link rel="preconnect" href="https://docs.getgrist.com">
  <link rel="dns-prefetch" href="https://docs.getgrist.com">
  <style>
    :root { --bg:#020617; --grist-offset:56px; }
    html, body { margin:0; padding:0; height:100%; background:var(--bg); }
    #wrapper { position:fixed; inset:0; overflow:hidden; background:var(--bg); }
    #gristFrame { position:absolute; top:calc(-1 * var(--grist-offset)); left:0; width:100%; height:calc(100% + var(--grist-offset)); border:0; background:white; }
    #fallback { position:fixed; inset:0; display:none; align-items:center; justify-content:center; color:#fff; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding:24px; text-align:center; }
    #fallback a { color:#93c5fd; }
  </style>
</head>
<body>
  <div id="wrapper">
    <iframe id="gristFrame" src="about:blank" allowfullscreen></iframe>
  </div>
  <div id="fallback">
    <div>
      <div style="font-size:18px;font-weight:700;margin-bottom:8px;">Lien incomplet</div>
      <div style="opacity:.9;line-height:1.35">Le paramètre <b>rowId</b> est présent, mais l’URL Grist de base est manquante.<br>Vérifie que tu as bien remplacé le fichier <b>guide_iframe.html</b> par la dernière version.</div>
      <div style="margin-top:12px;opacity:.9">Exemple attendu : <code>?rowId=73</code> suffit avec cette version.</div>
    </div>
  </div>

  <script>
    // Configuration "fixe" : ta page Grist intégrée
    const GRIST_BASE = "https://docs.getgrist.com/gvPEJV3qAHS9/Equipements-de-travail-et-produits/p/119";
    const DEFAULT_QUERY = "embed=true&style=singlePage&exclude-headers=true";
    const TABLE_NAME = "Liste_des_equipements";

    function getParam(name) {
      const u = new URL(window.location.href);
      return u.searchParams.get(name) || "";
    }

    function buildGristUrl(rowId) {
      const base = new URL(GRIST_BASE);
      // force embed params
      base.search = DEFAULT_QUERY;
      // deep-link (robuste mobile)
      return `${base.toString()}#?table=${encodeURIComponent(TABLE_NAME)}&rowId=${encodeURIComponent(rowId)}`;
    }

    function boot() {
      const rowId = getParam("rowId");
      const frame = document.getElementById("gristFrame");

      if (!rowId) {
        document.getElementById("fallback").style.display = "flex";
        return;
      }

      const url = buildGristUrl(rowId);
      frame.src = url;
    }

    boot();
  </script>
</body>
</html>
